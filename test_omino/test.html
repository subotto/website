<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Test Subbotto SVG</title>

  <!--<link rel="stylesheet" href="css/styles.css?v=1.0">-->

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  
   <script src="js/jquery.js"></script>
  <script src="js/svg.js"></script>

</head>

<body>
	
	<script>
		function cart2pol(p) {
			return [p[0],Math.sqrt(p[1]*p[1]+p[2]*p[2]), Math.atan2(p[2],p[1])];
		}
		
		function pol2cart(p) {
			return [p[0],p[1]*Math.cos(p[2]), p[1]*Math.sin(p[2])];
		}		
				
		function create_mesh(draw) {
			var mesh=new Object();
			
			/*var mesh_points=[
				[0,-39,-2], // vertice testa
				[7.5,-35.5,-1],[9.2,-26.54,1], // metà testa
				[5.4,-18.3,0], // collo
				[15.5,-12,4], // spalla
				[18,-6.5,6], [18,14,6], // stecca
				[15,18.5,5],[9,56.5,3], // gambe
				[11,58,-5],[11,73,5], // base

				[-11,73,5],[-11,58,-5], // base
				[-9,56.5,3],[-15,18.5,5], // gambe
				[-18,14,6],[-18,-6.5,6], // stecca
				[-15.5,-12,4], // spalla
				[-5.4,-18.3,0], // collo												
				[-9.2,-26.54,1],[-7.5,-35.5,0], // metà testa
			];*/
				
			/*
			var mesh_points=[
				[10,-35,-12],
				[30,-24,-12],
				[30,24,-12],
				[30,24,	12],
				[26,31,12],
				[15,100,12],
				[15,100,-9],
				[20,102,-11],
				[20,102,16],
				[21,134,16],
				
				[-21,134,16],
				[-20,102,16],
				[-20,102,-11],
				[-15,100,-9],
				[-15,100,12],
				[-26,31,12],
				[-30,24,12],
				[-30,24,-12],
				[-30,-24,-12],
				[-10,-35,-12]
			];
			*/
			/* testa 
			var mesh_points=[
				[0,-72,-10],
				[13,-64,-10],
				[16,-51,-8],
				[16,-50,8],
				[10,-35,7],
				
				[-10,-35,7],
				[-16,-50,8],
				[-16,-51,-8],
				[-13,-64,-10],
			];
			*/
			
			var mesh_points=[
				[0,-72,-13],
				[13,-64,-13],
				[16,-51,-10],
				[16,-51,8],
				[10,-35,7],
				
				[10,-35,-12],
				[30,-24,-12],
				[30,24,-12],
				[30,24,	12],
				[26,31,12],
				[15,100,12],
				[15,100,-9],
				[20,102,-11],
				[20,102,16],
				[21,134,16],
				
				//simmetrico
				
				[-21,134,16],
				[-20,102,16],
				[-20,102,-11],
				[-15,100,-9],
				[-15,100,12],
				[-26,31,12],
				[-30,24,12],
				[-30,24,-12],
				[-30,-24,-12],
				[-10,-35,-12],
				
				[-10,-35,7],
				[-16,-51,8],
				[-16,-51,-10],
				[-13,-64,-13],
			];
			
			
			mesh.data=mesh_points.map(cart2pol);
			
			mesh.angle=0.0;
			
			mesh.rotate = function(angle) {
				mesh.data=mesh.data.map(function(d) {d[2]=d[2]+angle; return d;});
				mesh.angle+=angle;
			}
			
			mesh.rotate_to = function(angle) {
				mesh.rotate(angle-mesh.angle);
			}
			
			mesh.group=draw.group();
			mesh.path=mesh.group.path('',true);
			mesh.fill=mesh.group.path('',true);
			
			
			mesh.draw = function() {
				var points=mesh.data.map(pol2cart);
				points=points.map(function(p) {return [p[0]+100,p[1]+100,p[2]];});
				var s="M ";
				for (var i=0;i<points.length;++i) {
					s+=points[i][0]+","+points[i][1]+" ";
				}
				s+="z"
				
				mesh.path.attr('d',s);
				mesh.path.attr({ fill: 'none' , stroke: '#000', 'stroke-width': 2})
				mesh.fill.attr('d',s);
				mesh.fill.attr({ fill: "#00f",'fill-opacity': 0.85,stroke: 'none'});
				
			}
			
			
			return mesh;
		}
	</script>
	
	<input type="range" id="angle_slider" min="-157" max="0"><span id="angle_value"></span>
	<div id="canvas" style="width:300px; height: 300px"></div>
	
	<script>
		var draw = SVG('canvas');
		mesh=create_mesh(draw);

		$("#angle_slider").change(function() {
			direction=0;

			mesh.rotate_to($('#angle_slider').val()/100);
			$('#angle_value').text($('#angle_slider').val());
			mesh.draw();
		});
		
		var angle=-1.57;
		var direction=1;
		
		setInterval(function() {
				if (direction==0) return;
			
				if (angle>=0)
					direction=-1;
				if (angle<=-1.57)
					direction=1;
				angle+=direction*Math.PI/50.0;
				
				mesh.rotate_to(angle);
				
				mesh.draw();
			}
			,1000.0/50);

	</script>
</body>

</html>
